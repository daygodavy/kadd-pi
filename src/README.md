# Source Code Overview
In this directory is the main parts of the source code to run the ATV crash detection system.

## General Overview
* starter.py
    * Orchestrates two threads: one to collect data, the other to send old rides to the database
* sensors.py
    * Logs data from both the IMU and GPS
    * Sends emergency messages from either rollover, or keyfob (default GPIO23)
    * Stores ride data in `../data/rides`
        * Research IMU data is collected in `../data/rides/imuComplete` for rides in research mode
* db.py
    * Performs all database interactions
    * Authenticates device with Firestore and sends IMU and GPS logs collected in Farm mode (mode 0)


Below are some graphs to show how these files interact with one another.

### Database Interaction
[![](https://mermaid.ink/img/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG4uLi9kYXRhL2N1cnJlbnQtLT4-Li4vZGF0YS91bnNlbnQ6IG1vdmUgZmlsZXNcbnN0YXJ0ZXIucHktLT4-Li4vZGF0YS91bnNlbnQ6IGZldGNoIGZpbGVzXG4uLi9kYXRhL3Vuc2VudC0tPj5zdGFydGVyLnB5OiByZXR1cm4gZmlsZXNcbnN0YXJ0ZXIucHktPj5kYi5weTogc2VuZCBjdXJyZW50IGZpbGVcbmRiLnB5LT4-ZmlyZXN0b3JlOiBhZ0NlcnQuanNvblxuZmlyZXN0b3JlLT4-ZGIucHk6IGF1dGhvcml6YXRpb25cbmRiLnB5LT4-ZmlyZXN0b3JlOiBzZW5kIGZpbGVcbmRiLnB5LT4-c3RhcnRlci5weTogcmV0dXJuIGNvbnRyb2xcbi4uL2RhdGEvdW5zZW50LS0-Pi4uL2RhdGEvc2VudDogbW92ZSBmaWxlXG5cblx0XHQiLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9fQ)](https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG4uLi9kYXRhL2N1cnJlbnQtLT4-Li4vZGF0YS91bnNlbnQ6IG1vdmUgZmlsZXNcbnN0YXJ0ZXIucHktLT4-Li4vZGF0YS91bnNlbnQ6IGZldGNoIGZpbGVzXG4uLi9kYXRhL3Vuc2VudC0tPj5zdGFydGVyLnB5OiByZXR1cm4gZmlsZXNcbnN0YXJ0ZXIucHktPj5kYi5weTogc2VuZCBjdXJyZW50IGZpbGVcbmRiLnB5LT4-ZmlyZXN0b3JlOiBhZ0NlcnQuanNvblxuZmlyZXN0b3JlLT4-ZGIucHk6IGF1dGhvcml6YXRpb25cbmRiLnB5LT4-ZmlyZXN0b3JlOiBzZW5kIGZpbGVcbmRiLnB5LT4-c3RhcnRlci5weTogcmV0dXJuIGNvbnRyb2xcbi4uL2RhdGEvdW5zZW50LS0-Pi4uL2RhdGEvc2VudDogbW92ZSBmaWxlXG5cblx0XHQiLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9fQ)

### Sensor Logging
[![](https://mermaid.ink/img/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG5zdGFydGVyLnB5LT4-c2Vuc29ycy5weTogc3RhcnQgc2FtcGxpbmdcbmxvb3AgdW50aWwgcG93ZXIgbG9zc1xuXHRcdHNlbnNvcnMucHktPj5JTVU6IGNvbGxlY3Qgc2FtcGxlXG4gICAgICAgIElNVS0-PnNlbnNvcnMucHk6IHJldHVybiBkYXRhXG4gICAgICAgIHNlbnNvcnMucHktPj5HUFM6IGNvbGxlY3Qgc2FtcGxlXG5cdFx0R1BTLT4-c2Vuc29ycy5weTogcmV0dXJuIGRhdGEgKGlmIGNvbm5lY3RlZClcblx0XHRzZW5zb3JzLnB5LT4-c2Vuc29ycy5weTogY2hlY2sgZm9yIHJvbGxvdmVyXG5cdFx0YWx0IHJvbGxcblx0XHRcdHNlbnNvcnMucHktLT4-c2Vuc29ycy5weTogaW5jcmVtZW50IGNvdW50ZXJcblx0XHRlbHNlIG5vIHJvbGxcblx0XHRcdHNlbnNvcnMucHktLT4-c2Vuc29ycy5weTogZGVjcmVtZW50IGNvdW50ZXJcblx0XHRlbmRcblx0XHRzZW5zb3JzLnB5LT4-c2Vuc29ycy5weTogY2hlY2sgaWYgdGhyZXNob2xkIHJlYWNoZWRcblx0XHRhbHQgcmVhY2hlZCBvciBrZXkgZm9iIEdQSU8gc2V0IGhpZ2hcblx0XHRcdHNlbnNvcnMucHktPj4uLi9yaWRlcy9jdXJyZW50OiB3cml0ZSBHUFMgYW5kIElNVSBkYXRhXG5cdFx0XHRzZW5zb3JzLnB5LT4-Um9ja0JMT0NLOiBzZW5kIGFsZXJ0XG5cdFx0XHRSb2NrQkxPQ0stPj5JcmlkaXVtIE5ldHdvcms6IHRyYW5zbWl0IG1lc3NhZ2Vcblx0XHRlbHNlIG5vdCByZWFjaGVkXG5cdFx0XHRzZW5zb3JzLnB5LS0-PnNlbnNvcnMucHk6IGNvbnRpbnVlXG5cdFx0ZW5kXG5cdFx0c2Vuc29ycy5weS0-Pi4uL3JpZGVzL2N1cnJlbnQ6IHdyaXRlIEdQUyBhbmQgSU1VIGRhdGFcbmVuZCIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2V9)](https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG5zdGFydGVyLnB5LT4-c2Vuc29ycy5weTogc3RhcnQgc2FtcGxpbmdcbmxvb3AgdW50aWwgcG93ZXIgbG9zc1xuXHRcdHNlbnNvcnMucHktPj5JTVU6IGNvbGxlY3Qgc2FtcGxlXG4gICAgICAgIElNVS0-PnNlbnNvcnMucHk6IHJldHVybiBkYXRhXG4gICAgICAgIHNlbnNvcnMucHktPj5HUFM6IGNvbGxlY3Qgc2FtcGxlXG5cdFx0R1BTLT4-c2Vuc29ycy5weTogcmV0dXJuIGRhdGEgKGlmIGNvbm5lY3RlZClcblx0XHRzZW5zb3JzLnB5LT4-c2Vuc29ycy5weTogY2hlY2sgZm9yIHJvbGxvdmVyXG5cdFx0YWx0IHJvbGxcblx0XHRcdHNlbnNvcnMucHktLT4-c2Vuc29ycy5weTogaW5jcmVtZW50IGNvdW50ZXJcblx0XHRlbHNlIG5vIHJvbGxcblx0XHRcdHNlbnNvcnMucHktLT4-c2Vuc29ycy5weTogZGVjcmVtZW50IGNvdW50ZXJcblx0XHRlbmRcblx0XHRzZW5zb3JzLnB5LT4-c2Vuc29ycy5weTogY2hlY2sgaWYgdGhyZXNob2xkIHJlYWNoZWRcblx0XHRhbHQgcmVhY2hlZCBvciBrZXkgZm9iIEdQSU8gc2V0IGhpZ2hcblx0XHRcdHNlbnNvcnMucHktPj4uLi9yaWRlcy9jdXJyZW50OiB3cml0ZSBHUFMgYW5kIElNVSBkYXRhXG5cdFx0XHRzZW5zb3JzLnB5LT4-Um9ja0JMT0NLOiBzZW5kIGFsZXJ0XG5cdFx0XHRSb2NrQkxPQ0stPj5JcmlkaXVtIE5ldHdvcms6IHRyYW5zbWl0IG1lc3NhZ2Vcblx0XHRlbHNlIG5vdCByZWFjaGVkXG5cdFx0XHRzZW5zb3JzLnB5LS0-PnNlbnNvcnMucHk6IGNvbnRpbnVlXG5cdFx0ZW5kXG5cdFx0c2Vuc29ycy5weS0-Pi4uL3JpZGVzL2N1cnJlbnQ6IHdyaXRlIEdQUyBhbmQgSU1VIGRhdGFcbmVuZCIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2V9)
